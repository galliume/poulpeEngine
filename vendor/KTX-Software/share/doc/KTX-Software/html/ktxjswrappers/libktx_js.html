<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KTX Javascript Wrappers Reference: libktx Binding</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ktx_logo_200.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KTX Javascript Wrappers Reference
   &#160;<span id="projectnumber">4.3.2</span>
   </div>
   <div id="projectbrief">Libraries and tools to create and read KTX image texture files.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('libktx_js.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">libktx Binding </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md1"></a>
WebIDL for the binding</h2>
<div class="fragment"><div class="line">interface ktxOrientation {</div>
<div class="line">    readonly attribute OrientationX x;</div>
<div class="line">    readonly attribute OrientationY y;</div>
<div class="line">    readonly attribute OrientationZ z;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">interface ktxUploadResult {</div>
<div class="line">    readonly attribute WebGLTexture texture;</div>
<div class="line">    readonly attribute GLenum target;</div>
<div class="line">    readonly attribute GLenum error;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">interface ktxTexture {</div>
<div class="line">    void ktxTexture(ArrayBufferView fileData);</div>
<div class="line">    UploadResult glUpload();</div>
<div class="line">    ErrorCode transcodeBasis();</div>
<div class="line"> </div>
<div class="line">    readonly attribute long baseWidth;</div>
<div class="line">    readonly attribute long baseHeight;</div>
<div class="line">    readonly attribute bool isPremultiplied;</div>
<div class="line">    readonly attribute bool needsTranscoding;</div>
<div class="line">    readonly attribute long numComponents;</div>
<div class="line">    readonly attribute long vkFormat;</div>
<div class="line">    readonly attribute SupercmpScheme supercompressionScheme;</div>
<div class="line">    readonly attribute ktxOrientation orientation;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">enum ErrorCode = {</div>
<div class="line">    &quot;SUCCESS&quot;,</div>
<div class="line">    &quot;FILE_DATA_ERROR&quot;,</div>
<div class="line">    &quot;FILE_ISPIPE&quot;,</div>
<div class="line">    &quot;FILE_OPEN_FAILED&quot;,</div>
<div class="line">    &quot;FILE_OVERFLOW&quot;,</div>
<div class="line">    &quot;FILE_READ_ERROR&quot;,</div>
<div class="line">    &quot;FILE_SEEK_ERROR&quot;,</div>
<div class="line">    &quot;FILE_UNEXPECTED_ERROR&quot;,</div>
<div class="line">    &quot;FILE_WRITE_ERROR&quot;,</div>
<div class="line">    &quot;GL_ERROR&quot;,</div>
<div class="line">    &quot;INVALID_OPERATION&quot;,</div>
<div class="line">    &quot;INVALID_VALUE&quot;,</div>
<div class="line">    &quot;NOT_FOUND&quot;,</div>
<div class="line">    &quot;OUT_OF_MEMORY&quot;,</div>
<div class="line">    &quot;TRANSCODE_FAILED&quot;,</div>
<div class="line">    &quot;UNKNOWN_FILE_FORMAT&quot;,</div>
<div class="line">    &quot;UNSUPPORTED_TEXTURE_TYPE&quot;,</div>
<div class="line">    &quot;UNSUPPORTED_FEATURE&quot;,</div>
<div class="line">    &quot;LIBRARY_NOT_LINKED&quot;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">// Some targets may not be available depending on options used when compiling</div>
<div class="line">// the web assembly. ktxTexture.transcodeBasis will report this.</div>
<div class="line">enum TranscodeTarget = {</div>
<div class="line">    &quot;ETC1_RGB&quot;,</div>
<div class="line">    &quot;BC1_RGB&quot;,</div>
<div class="line">    &quot;BC4_R&quot;,</div>
<div class="line">    &quot;BC5_RG&quot;,</div>
<div class="line">    &quot;BC3_RGBA&quot;,</div>
<div class="line">    &quot;BC1_OR_3&quot;,</div>
<div class="line">    &quot;PVRTC1_4_RGB&quot;,</div>
<div class="line">    &quot;PVRTC1_4_RGBA&quot;,</div>
<div class="line">    &quot;BC7_RGBA&quot;,</div>
<div class="line">    &quot;BC7_M6_RGB&quot;,  // Deprecated. Use BC7_RGBA.</div>
<div class="line">    &quot;BC7_M5_RGBA&quot;, // Deprecated. Use BC7_RGBA.</div>
<div class="line">    &quot;ETC2_RGBA&quot;,</div>
<div class="line">    &quot;ASTC_4x4_RGBA&quot;,</div>
<div class="line">    &quot;RGBA32&quot;,</div>
<div class="line">    &quot;RGB565&quot;,</div>
<div class="line">    &quot;BGR565&quot;,</div>
<div class="line">    &quot;RGBA4444&quot;,</div>
<div class="line">    &quot;PVRTC2_4_RGB&quot;,</div>
<div class="line">    &quot;PVRTC2_4_RGBA&quot;,</div>
<div class="line">    &quot;ETC&quot;,</div>
<div class="line">    &quot;EAC_R11&quot;,</div>
<div class="line">    &quot;EAC_RG11&quot;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">enum TranscodeFlagBits {</div>
<div class="line">   &quot;TRANSCODE_ALPHA_DATA_TO_OPAQUE_FORMATS&quot;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">enum OrientationX {</div>
<div class="line">    &quot;LEFT&quot;,</div>
<div class="line">    &quot;RIGHT&quot;</div>
<div class="line">};</div>
<div class="line">enum OrientationY {</div>
<div class="line">    &quot;UP&quot;,</div>
<div class="line">    &quot;DOWN&quot;</div>
<div class="line">};</div>
<div class="line">enum OrientationZ {</div>
<div class="line">    &quot;IN&quot;,</div>
<div class="line">    &quot;OUT&quot;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">enum SupercmpScheme {</div>
<div class="line">    &quot;NONE&quot;,</div>
<div class="line">    &quot;BASIS_LZ&quot;,</div>
<div class="line">    &quot;ZSTD&quot;</div>
<div class="line">    &quot;ZLIB&quot;</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2"></a>
How to use</h2>
<p>Put libktx.js and libktx.wasm in a directory on your server. Create a script tag with libktx.js as the <code>src</code> as shown below, changing the path as necessary for the relative locations of your .html file and the script source. libktx.js will automatically load msc_basis_transcoder.wasm.</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Create an instance of the LIBKTX module</h3>
<p>Add this to the .html file to initialize the libktx module and make it available on the main window. </p><div class="fragment"><div class="line">&amp;lt;script src=&quot;libktx.js&quot;&gt;&amp;lt;/script&gt;</div>
<div class="line">&amp;lt;script type=&quot;text/javascript&quot;&gt;</div>
<div class="line">  LIBKTX({preinitializedWebGLContext: gl}).then(module =&gt; {</div>
<div class="line">    window.LIBKTX = module;</div>
<div class="line">    // Make existing WebGL context current for Emscripten OpenGL.</div>
<div class="line">    LIBKTX.GL.makeContextCurrent(LIBKTX.GL.createContext(null, { majorVersion: 2.0 }));</div>
<div class="line">    texture = loadTexture(gl, &#39;ktx_app.ktx2&#39;);</div>
<div class="line">  });</div>
<div class="line">&amp;lt;/script&gt;</div>
</div><!-- fragment --><p><em>After</em> the module is initialized, invoke code that will directly or indirectly cause a function like the following to be executed.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
loadTexture function</h3>
<div class="fragment"><div class="line">// Set up an XHR to fetch the url into an ArrayBuffer.</div>
<div class="line">var xhr = new XMLHttpRequest();</div>
<div class="line">xhr.open(&#39;GET&#39;, url);</div>
<div class="line">xhr.responseType = &quot;arrayBuffer&quot;;</div>
<div class="line">xhr.onload = function() {</div>
<div class="line">  const { ktxTexture, TranscodeTarget, OrientationX, OrientationY } = LIBKTX;</div>
<div class="line">  // this.response is a generic binary buffer which</div>
<div class="line">  // we can interpret as Uint8Array.</div>
<div class="line">  var ktxdata = new Uint8Array(this.response);</div>
<div class="line">  ktexture = new ktxTexture(ktxdata);</div>
<div class="line"> </div>
<div class="line">  if (ktexture.needsTranscoding) {</div>
<div class="line">    var formatString;</div>
<div class="line">    var format;</div>
<div class="line">    if (astcSupported) {</div>
<div class="line">      formatString = &#39;ASTC&#39;;</div>
<div class="line">      format = TranscodeTarget.ASTC_4x4_RGBA;</div>
<div class="line">    } else if (dxtSupported) {</div>
<div class="line">      formatString = &#39;BC1 or BC3&#39;;</div>
<div class="line">      format = TranscodeTarget.BC1_OR_3;</div>
<div class="line">    } else if (pvrtcSupported) {</div>
<div class="line">      formatString = &#39;PVRTC1&#39;;</div>
<div class="line">      format = TranscodeTarget.PVRTC1_4_RGBA;</div>
<div class="line">    } else if (etcSupported) {</div>
<div class="line">      formatString = &#39;ETC&#39;;</div>
<div class="line">      format = TranscodeTarget.ETC;</div>
<div class="line">    } else {</div>
<div class="line">      formatString = &#39;RGBA4444&#39;;</div>
<div class="line">      format = TranscodeTarget.RGBA4444;</div>
<div class="line">    }</div>
<div class="line">    if (ktexture.transcodeBasis(format, 0) != LIBKTX.ErrorCode.SUCCESS) {</div>
<div class="line">      alert(&#39;Texture transcode failed. See console for details.&#39;);</div>
<div class="line">      return undefined;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  // If there is no global variable &quot;texture&quot;.</div>
<div class="line">  //const {texture, target, error} = ktexture.glUpload();</div>
<div class="line">  // If there is a globla variable &quot;texture&quot;</div>
<div class="line">  const result = ktexture.glUpload();</div>
<div class="line">  const {target, error} = result;</div>
<div class="line">  texture = result.texture;</div>
<div class="line"> </div>
<div class="line">  if (error != gl.NO_ERROR) {</div>
<div class="line">    alert(&#39;WebGL error when uploading texture, code = &#39; + error.toString(16));</div>
<div class="line">    return undefined;</div>
<div class="line">  }</div>
<div class="line">  if (texture === undefined) {</div>
<div class="line">    alert(&#39;Texture upload failed. See console for details.&#39;);</div>
<div class="line">    return undefined;</div>
<div class="line">  }</div>
<div class="line">  if (target != gl.TEXTURE_2D) {</div>
<div class="line">    alert(&#39;Loaded texture is not a TEXTURE2D.&#39;);</div>
<div class="line">    return undefined;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  gl.bindTexture(target, texture);</div>
<div class="line">  // If using a placeholder texture during loading, delete</div>
<div class="line">  // it now.</div>
<div class="line">  //gl.deleteTexture(placeholder);</div>
<div class="line"> </div>
<div class="line">  if (ktexture.numLevels &gt; 1 || ktexture.generateMipmaps)</div>
<div class="line">     // Enable bilinear mipmapping.</div>
<div class="line">     gl.texParameteri(target,</div>
<div class="line">                      gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);</div>
<div class="line">  else</div>
<div class="line">    gl.texParameteri(target, gl.TEXTURE_MIN_FILTER, gl.LINEAR);</div>
<div class="line">  gl.texParameteri(target, gl.TEXTURE_MAG_FILTER, gl.LINEAR);</div>
<div class="line"> </div>
<div class="line">  if (ktexture.orientation.x == OrientationX.LEFT) {</div>
<div class="line">    // Adjust u coords, e.g. by setting up a uv transform</div>
<div class="line">  }</div>
<div class="line">  if (ktexture.orientation.y == OrientationY.DOWN) {</div>
<div class="line">    // Adjust v coords, e.g. by setting up a uv transform</div>
<div class="line">  }</div>
<div class="line">  ktexture.delete();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">xhr.send();</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>It is not clear if glUpload can be used with, e.g. THREE.js. It may be necessary to expose the ktxTexture_IterateLevelFaces or ktxTexture_IterateLoadLevelFaces API to JS with those calling a callback in JS to upload each image to WebGL. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li>
    <li class="footer">Generated on Wed Mar 20 2024 17:40:15 for KTX Javascript Wrappers Reference by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
